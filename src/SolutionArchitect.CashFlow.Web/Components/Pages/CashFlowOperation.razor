@page "/cashflow"
@using SolutionArchitect.CashFlow.Web.Contracts
@using SolutionArchitect.CashFlow.Web.Services.Clients
@rendermode InteractiveServer
@inject CashFlowClient Client

<h3>Lançamento de CashFlow</h3>

<div class="mb-3">
    <label class="form-label">Tipo de Operação</label>
    <select class="form-select" @bind="operationType">
        <option value="">Selecione</option>
        <option value="Credit">Crédito</option>
        <option value="Debit">Débito</option>
    </select>
</div>

<div class="mb-3">
    <label class="form-label">Valor</label>
    <input type="number"
           step="0.01"
           class="form-control"
           @bind="amount" />
</div>

<button class="btn btn-primary"
        @onclick="SubmitAsync"
        disabled="@loading">
    Salvar
</button>

@if (loading)
{
    <p class="mt-3">Processando...</p>
}
else if (success)
{
    <div class="alert alert-success mt-3">
        Operação registrada com sucesso!
    </div>
}
else if (errorMessage is not null)
{
    <div class="alert alert-danger mt-3">
        @errorMessage
    </div>
}

@code {
    private string operationType = string.Empty;
    private decimal amount;
    private bool loading;
    private bool success;
    private string? errorMessage;

    private async Task SubmitAsync()
    {
        success = false;
        errorMessage = null;

        if (string.IsNullOrWhiteSpace(operationType) || amount <= 0)
        {
            errorMessage = "Informe um tipo de operação e um valor válido.";
            return;
        }

        loading = true;

        try
        {
            await Client.ExecuteAsync(
                new ExecuteCashFlowOperationRequest(
                    operationType,
                    amount),
                CancellationToken.None);

            success = true;
            amount = 0;
            operationType = string.Empty;
        }
        catch (Exception ex)
        {
            errorMessage = ex.Message;
        }
        finally
        {
            loading = false;
        }
    }
}